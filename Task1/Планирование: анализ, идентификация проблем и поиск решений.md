# Планирование: анализ, идентификация проблем и поиск решений

Компания столкнулась с рядом проблем:

1. Линейный рост нагрузки по поступающим заказам.
2. Задержки в выполнении и даже потери заказов.
3. Появились задержки в загрузке первой страницы MES у операторов.
4. Разработчики не могут понять в каком сервисе узкое место.

В результате анализа проблем и текущей архитектуры системы, можно выделить следующие проблемные места:

1. Заказ с 3D-моделью поступает в MES через очередь, но не напрямую с интернет-магазина Shop, а через CRM.  CRM - лишнее звено и пересылка заказов создает дополнительную нагрузку на CRM и на БД Shop (лишние запросы, которые можно было избежать).
2. Статусы обработки заказа и результаты расчета стоимости обратно поступают в базу данных Shop также через CRM.
3. CRM не имеет собственной БД и обращается за заказами в БД Shop напрямую, соответственно, полагаю, что клиенты хранятся в БД Shop, что странно с точки зрения микросервисной архитектуры. Общая БД будет аффектить производительность обоих микросервисов.
4. MES выполняет функционал двух микросервисов: собственно само производство и работа операторов с заказами и API для приема заказов от партнеров. Эти две задачи в рамках одного микросервиса аффектят производительность друг друга.

Для решения выявленных проблем и устранения проблемных мест необходимо реализовать следующие задачи в порядке убывания приоритета:

1. Изменить маршрут заказов из Shop в MES, чтобы заказы сразу поступали в очередь, минуя CRM.
2. Изменить обратный маршрут сообщений об изменении статусов обработки заказов, чтобы сообщения сразу поступали в очередь, минуя CRM.
3. Вынести API приема заказов от партнеров из MES в отдельный микросервис.
4. Создать для микросервиса CRM базу данных клиентов, мигрировать данные из БД Shop.

В ближайшие полгода необходимо реализовать задачи по п. 1-3:

- 1-3 месяцы: в первую очередь функционал обработки заказов существующих частных клиентов, чтобы их не потерять оставшихся - это основа бизнеса.
- 4-6 месяцы: выделение API приема заказов из MES в отдельный микросервис.

В целевом виде архитектура системы будет выглядить следующим образом:
* Сообщения о заказах будут передаваться между сервисами Shop и MES напрямую через очередь.
* API приема партнерских заказов - отдельный микросервис со своей БД, который также связан с MES через очередь.
