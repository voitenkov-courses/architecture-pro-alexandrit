# Архитектурное решение по трейсингу

Для диагностики прохождения запросов между сервисами и обработки запросов внутри каждого сервиса необходимо интегрировать трассировку в следующие сервисы:

* Shop API
* CRM API
* MES API
* RabbitMQ

В трейсинг должны попадать следующие данные:
- Окружение
- Запрос (полный путь)
- Компонент микросервиса, через которую проходит запрос
- Ответ (Response)
- Очередь (при прохлждении через RabbitMQ)
- Время выполнения каждого спана

## Мотивация

Внедрение распределенного трейсинга позволит повлиять на следующие метрики:

* Response time (latency)
* Number of HTTP 500
* Number of dead-letter-exchange letters

## Предлагаемое решение

Для реализации распределенного трейсинга можно использовать решения стандарта OpenTelemetry:

- OTel SDK интеграции в код сервисов
- Jaeger All-In-One в качестве платформы трейсинга

Диаграмма контейнеров системы с учетом доработок изображена на следующей схеме, красным цветом выделены новые контейнеры:

![alexandrit-c4](jewerly_c4_model.png)

# Компромиссы

Реализация трейсинга в MES будет более трудозатратным, так как этот сервис изначально разрабатывался в другой компании. Тем не менее для полноты картины его надо реазовать, возможно в последнюю очередь при наличии ресурсов.

# Безопасность

Меры по защите системы трейсинга:

* Внедрение аутентификации — зайти в систему смогут только сотрудники компании с актуальной учетной записью и ролью “Поддержка”.
* Настройка авторизации средствами Jaeger
* Включение шифрование трафика телеметрии по протоколу HTTPS