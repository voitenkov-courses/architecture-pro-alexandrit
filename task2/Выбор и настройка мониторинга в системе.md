# Выбор и настройка мониторинга в системе

## Мотивация

С увеличением количества поступающих заказов в разных сервисах системы стали возникать проблемы с производительностью, отзывчивостью интерфейса, потери заказов. Для того, чтобы оперативно реагировать на подобные проблемы, необходимо добавить в систему мониторинг. Это даст компании возможность обеспечивать требуемый уровень надежности сервисов при росте нагрузки.

## Выбор подхода к мониторингу

Рассматриваемая система использует API. При проектировании системы мониторинга для данной архитектуры лучше всего подходит подход «Четыре золотых сигнала». Он позволяет заметить аномалии в работе заранее и быстро среагировать на ситуацию. Это также самый универсальный метод и он подойдет для мониторинга всех частей системы.

Отслеживаемые метрики

|Сервис|Метрика|Обоснование|Метки|
|------|-------|-----------|-----|
|Shop API|Number of requests (RPS)|Показывает нагрузку на сервис со стороны пользователей|method, url  |
|Shop API|CPU %|Требуется для понимания предела производительности|core|
|Shop API|Memory Utilisation|Требуется для понимания предела производительности||
|Shop API|Response time (latency)|Говорит о проблемах в сервисе|method, url|
|Shop API|Number of HTTP 200|Для расчета уровня надежности|method, url|
|Shop API|Number of HTTP 500|Для расчета уровня надежности|method, url|
|Shop API|Number of simultanious sessions|Показывает нагрузку на сервис со стороны пользователей|region|
|CRM API|Number of requests (RPS)|Показывает нагрузку на сервис со стороны пользователей|method, url  |
|CRM API|CPU %|Требуется для понимания предела производительности|core|
|CRM API|Memory Utilisation|Требуется для понимания предела производительности||
|CRM API|Response time (latency)|Говорит о проблемах в сервисе|method, url|
|CRM API|Number of HTTP 200|Для расчета уровня надежности|method, url|
|CRM API|Number of HTTP 500|Для расчета уровня надежности|method, url|
|CRM API|Number of simultanious sessions|Показывает нагрузку на сервис со стороны пользователей|region|
|MES API|Number of requests (RPS)|Показывает нагрузку на сервис со стороны пользователей|method, url  |
|MES API|CPU %|Требуется для понимания предела производительности|core|
|MES API|Memory Utilisation|Требуется для понимания предела производительности||
|MES API|Response time (latency)|Говорит о проблемах в сервисе|method, url|
|MES API|Number of HTTP 200|Для расчета уровня надежности|method, url|
|MES API|Number of HTTP 500|Для расчета уровня надежности|method, url|
|MES API|Number of simultanious sessions|Показывает нагрузку на сервис со стороны пользователей|region|
|Shop DB|Memory Utilisation|Требуется для понимания предела производительности||
|Shop DB|Number of connections|Для настройки БД и исключения аварийных ситуаций||
|Shop DB|Size of instance|Для исключения аварийных ситуаций и превышения возможностей БД||
|MES DB|Memory Utilisation|Требуется для понимания предела производительности||
|MES DB|Number of connections|Для настройки БД и исключения аварийных ситуаций||
|MES DB|Size of instance|Для исключения аварийных ситуаций и превышения возможностей БД||
|RabbitMQ|Number of dead-letter-exchange letters|Говорит о проблемах в сервисе|Очередь|
|RabbitMQ|Number of message in flight|Показывает нагрузку на сервис|Очередь|

Примечание: для всех перечисленных метрик используется также метка "environment" (окружение: dev, release и prod)